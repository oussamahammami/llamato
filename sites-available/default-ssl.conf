<IfModule mod_ssl.c>
	<VirtualHost _default_:443>

		ServerAdmin webmaster@localhost
		DocumentRoot /var/www/html

		# Available loglevels: trace8, ..., trace1, debug, info, notice, warn,
		# error, crit, alert, emerg.
		# It is also possible to configure the loglevel for particular
		# modules, e.g.
		LogLevel debug ssl:debug
		#LogLevel info
		RewriteEngine On	
		ProxyRequests Off
		ProxyVia Off	
		# Create a load balancer named "app-cluster"
 		<Proxy balancer://app-cluster>
   			BalancerMember http://172.31.32.69:8080/
 			ProxySet lbmethod=byrequests
			ProxySet failonstatus=503
 		</Proxy>
		
 		ProxyPreserveHost On
		ProxyPass / balancer://app-cluster/
		ProxyPassReverse / balancer://app-cluster/

		CustomLog ${APACHE_LOG_DIR}/access.log combined	
		ErrorLog ${APACHE_LOG_DIR}/error.log
		
		<Location /balancer-manager>
        		SetHandler balancer-manager
			Order Deny,Allow
			Deny from All
    			Allow from 172.31.0.0/16
		</Location>


		SSLEngine on

		#   SSLCertificateFile directive is needed.
		SSLCertificateFile /etc/apache2/ssl/ramenlabs.io.pem
		SSLCertificateKeyFile /etc/apache2/ssl/ramenlabs.io.key
		SSLCertificateChainFile /etc/apache2/ssl/ramenlabs.io.ca
	
		#SSLOptions +FakeBasicAuth +ExportCertData +StrictRequire
		<FilesMatch "\.(cgi|shtml|phtml|php)$">
				SSLOptions +StdEnvVars
		</FilesMatch>
		<Directory /usr/lib/cgi-bin>
				SSLOptions +StdEnvVars
		</Directory>

		BrowserMatch "MSIE [2-6]" \
				nokeepalive ssl-unclean-shutdown \
				downgrade-1.0 force-response-1.0
		# MSIE 7 and newer should be able to use keepalive
		BrowserMatch "MSIE [17-9]" ssl-unclean-shutdown

	</VirtualHost>
</IfModule>
# vim: syntax=apache ts=4 sw=4 sts=4 sr noet
